- id: '1712649261862'
  alias: KB01 Bat
  description: ''
  trigger:
  - type: battery_level
    platform: device
    device_id: 814dcc4c7f838f1f70d1e038af08f51a
    entity_id: 7a0d142803725956b9320a196c2e8d74
    domain: sensor
    below: 100
  condition: []
  action:
  - service: notify.gHA
    data:
      message: 'Батарейка KB01 -  {{ states(''sensor.0xa4c138dda6382dba_battery'')
        }} '
- id: '1712772240218'
  alias: B1k D
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 814dcc4c7f838f1f70d1e038af08f51a
    type: action
    subtype: double
  condition: []
  action:
  - metadata: {}
    data: {}
    action: switch.toggle
    target:
      entity_id: switch.xs3
  mode: single
- id: '1713381585926'
  alias: B1k S
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 814dcc4c7f838f1f70d1e038af08f51a
    type: action
    subtype: single
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: light.lampochka_3
          state: 'off'
        - condition: and
          conditions:
          - condition: state
            entity_id: light.lampochka_3
            state: 'on'
          - condition: state
            entity_id: light.lampochka_3
            attribute: color_mode
            state: hs
          - condition: numeric_state
            entity_id: light.lampochka_3
            attribute: brightness
            below: 17
            enabled: true
      sequence:
      - action: light.turn_on
        target:
          device_id:
          - 2519fe869b93b107ae307fed766beb9f
        data:
          kelvin: 6500
          brightness_pct: 15
    - conditions:
      - condition: state
        entity_id: light.lampochka_3
        attribute: color_temp_kelvin
        state: 'null'
      sequence:
      - action: light.turn_on
        target:
          device_id:
          - 2519fe869b93b107ae307fed766beb9f
        data:
          kelvin: 2000
          brightness_pct: 15
    - conditions:
      - condition: numeric_state
        entity_id: light.lampochka_3
        above: 90
        attribute: brightness
      - condition: not
        conditions:
        - condition: state
          entity_id: light.lampochka_3
          attribute: color_temp_kelvin
          state: 'null'
      sequence:
      - action: light.turn_off
        metadata: {}
        data: {}
        target:
          device_id: 2519fe869b93b107ae307fed766beb9f
      - data: {}
        target:
          entity_id: timer.lw03
        action: timer.cancel
    - conditions:
      - condition: not
        conditions:
        - condition: state
          entity_id: light.lampochka_3
          attribute: color_temp_kelvin
          state: 'null'
      sequence:
      - action: light.turn_on
        target:
          device_id:
          - 2519fe869b93b107ae307fed766beb9f
        data:
          kelvin: 6500
          brightness_pct: 100
  mode: single
- id: '1714653788410'
  alias: xs3 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.xs3
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: switch.xs3
    state: 'on'
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.xs3_on_off
  mode: single
- id: Температура_на_бойлера_телеграм
  alias: tg temp_kotel_u
  description: ''
  triggers:
  - event_type: telegram_command
    event_data:
      command: /stat_u
    context: {}
    trigger: event
  actions:
  - data:
      message: 'Температура улицы датчика котла -  {{ states(''sensor.kotel_ulitsa_k'')
        }} '
    action: notify.me
- id: Отопление_телеграм
  alias: Otoplenie - Tg msg
  description: ''
  triggers: []
  actions:
  - action: notify.me
    data:
      title: Отопление {{ states('sensor.kotel_otoplenie') }}
      message: "\U0001F321 зал {{ states('sensor.tr2_temperature') }}\n\U0001F321
        кор {{ states('sensor.tr01_temperature') }}\n\U0001F321 сени {{ states('sensor.klimat_seni1_t1')
        }}\n\U0001F321 ул {{ states('sensor.kotel_ulitsa_k') }}\n\U0001F321 СО {{
        states('sensor.kotel_otopleniia') }}\n⌚️ {{ states('sensor.time') }}    \n"
      data:
        disable_notification: true
    enabled: true
  - data:
      title: Отопление {{ states('sensor.kotel_otoplenie') }}
      message: "\U0001F321 зал {{ states('sensor.tr2_temperature') }}\n\U0001F321
        кор {{ states('sensor.tr01_temperature') }}\n\U0001F321 сени {{ states('sensor.klimat_seni1_t1')
        }}\n\U0001F321 ул {{ states('sensor.kotel_ulitsa_k') }}\n\U0001F321 СО {{
        states('sensor.kotel_otopleniia') }}\n⌚️ {{ states('sensor.time') }}   \n"
      data:
        disable_notification: true
    action: notify.gHA
    enabled: false
- id: '1715770066650'
  alias: tg temp_kotel_h
  description: ''
  triggers:
  - event_type: telegram_command
    event_data:
      command: /stat_h
    context: {}
    trigger: event
  - event_type: telegram_command
    event_data:
      command: /stat_h@asg_ha_bot
    context: {}
    trigger: event
  actions:
  - action: notify.gHA
    data:
      title: Запрос Tg
      message: "\U0001F4DF Котёл - {{ states('sensor.kotel_kotel') }}\n\U0001F321
        зал {{ states('sensor.tr01_temperature') }}\n\U0001F321 ул {{ states('sensor.kotel_ulitsa_k')
        }}\n\U0001F321 ГВС {{ states('sensor.kotel_goriachei_vody') }}\n\U0001F321
        СО {{ states('sensor.kotel_otopleniia') }}\n\U0001F6B0 Горячая вода {{ states('sensor.kotel_goriachaia_voda')
        }}\n♻️ Отопление {{ states('sensor.kotel_otoplenie') }}\n\U0001F39B Отопление
        {{ states('switch.kotel_otoplenie') }}\n\U0001F39B Горячая вода {{ states('switch.kotel_gvs')
        }}\n"
      data:
        disable_notification: true
  - action: notify.me
    data:
      title: Запрос Tg
      message: "\U0001F4DF Котёл {{ states('sensor.kotel_kotel') }}\n\U0001F321 зал
        {{ states('sensor.tr01_temperature') }}\n\U0001F321 ул {{ states('sensor.kotel_ulitsa_k')
        }}\n\U0001F321 ГВС {{ states('sensor.kotel_goriachei_vody') }}\n\U0001F321
        СО {{ states('sensor.kotel_otopleniia') }}\n\U0001F6B0 Горячая вода {{ states('sensor.kotel_goriachaia_voda')
        }}\n♻️ Отопление {{ states('sensor.kotel_otoplenie') }}\n\U0001F39B Отопление
        {{ states('switch.kotel_otoplenie') }}\n\U0001F39B Горячая вода {{ states('switch.kotel_gvs')
        }}\n"
      data:
        disable_notification: true
  - action: notify.gDA
    data:
      title: Запрос Tg
      message: "\U0001F4DF Котёл {{ states('sensor.kotel_kotel') }}\n\U0001F321 зал
        {{ states('sensor.tr01_temperature') }}\n\U0001F321 ул {{ states('sensor.kotel_ulitsa_k')
        }}\n\U0001F321 ГВС {{ states('sensor.kotel_goriachei_vody') }}\n\U0001F321
        СО {{ states('sensor.kotel_otopleniia') }}\n\U0001F6B0 Горячая вода {{ states('sensor.kotel_goriachaia_voda')
        }}\n♻️ Отопление {{ states('sensor.kotel_otoplenie') }}\n\U0001F39B Отопление
        {{ states('switch.kotel_otoplenie') }}\n\U0001F39B Горячая вода {{ states('switch.kotel_gvs')
        }}\n"
      data:
        disable_notification: true
    enabled: false
- id: '1716402864159'
  alias: Lz01 On/Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.lz01
    for:
      hours: 0
      minutes: 0
      seconds: 3
  condition: []
  action:
  - if:
    - condition: state
      entity_id: light.lz01
      state: 'on'
    - condition: state
      entity_id: timer.ms2
      state: active
    then:
    - entity_id: timer.lz01
      action: timer.cancel
    - entity_id: timer.lz01
      action: timer.start
  - if:
    - condition: state
      entity_id: light.lz01
      state: 'off'
    then:
    - entity_id: timer.lz01
      action: timer.cancel
  mode: single
- id: '1716404845307'
  alias: 'Lz01 tim '
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.lz01
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: light.lz01
    state: 'on'
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.lz01_on_off
  mode: single
- id: '1716571681246'
  alias: xs7 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.xs7
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: switch.xs7
    state: 'on'
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.ms4_xs7_on_off
  mode: single
- id: '1716729511804'
  alias: Xs1 LI - Xs1 Off
  description: Смарт почти заряжен, но не снят с зарядного
  trigger:
  - platform: state
    entity_id:
    - sensor.xs1_current
    for:
      hours: 0
      minutes: 0
      seconds: 11
  condition: []
  action:
  - if:
    - type: is_current
      condition: device
      device_id: 248486f1c4384b6b1c68e5549574e919
      entity_id: 15ead20135410acc93c2e876305b1487
      domain: sensor
      above: 0.02
      below: 0.027
    then:
    - type: turn_off
      device_id: 248486f1c4384b6b1c68e5549574e919
      entity_id: 6fdf8b7a83e61c2917176164af745dd3
      domain: switch
    - data: {}
      target:
        entity_id: timer.xs1
      action: timer.cancel
    - data: {}
      target:
        entity_id: timer.xs1
      action: timer.start
  mode: single
- id: '1716753864675'
  alias: xs1 tim - Xs1 On
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.xs1
    to: idle
    from: active
    for:
      hours: 0
      minutes: 0
      seconds: 11
  - platform: time_pattern
    minutes: '00'
    seconds: '11'
    enabled: true
  condition:
  - condition: state
    entity_id: timer.xs1
    state: idle
    for:
      hours: 0
      minutes: 0
      seconds: 5
  - condition: device
    type: is_off
    device_id: 248486f1c4384b6b1c68e5549574e919
    entity_id: 6fdf8b7a83e61c2917176164af745dd3
    domain: switch
  action:
  - type: turn_on
    device_id: 248486f1c4384b6b1c68e5549574e919
    entity_id: 6fdf8b7a83e61c2917176164af745dd3
    domain: switch
  mode: single
- id: '1717391523706'
  alias: ds01 LongOpen - Tg msg
  description: дверь открыта больше положенного времени - встуживание
  trigger:
  - platform: state
    entity_id:
    - timer.ds01
    for:
      hours: 0
      minutes: 0
      seconds: 1
    to: idle
    from: active
  condition:
  - condition: state
    entity_id: binary_sensor.ds01_contact
    state: 'on'
  action:
  - data:
      message: Дверь открыта больше 3 мин. -  {{ states('sensor.kotel_otopleniia')
        }}  - холод/мухи
    action: notify.gHA
  mode: single
- id: '1719765793495'
  alias: Boiler Oshibka - Tg msg
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.kotel_oshibka_kotla
    for:
      hours: 0
      minutes: 0
      seconds: 15
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.kotel_oshibka_kotla
      state: '...'
    - condition: state
      entity_id: sensor.kotel_oshibka_kotla
      state: нет
    - condition: state
      entity_id: sensor.kotel_oshibka_kotla
      state: unavailable
    - condition: state
      entity_id: sensor.kotel_oshibka_kotla
      state: unknown
  action:
  - data:
      title: Ошибка котла
      message: "\U0001F4DF Котёл - {{ states('sensor.kotel_kotel') }}\n⁉️ Ошибка -
        {{ states('sensor.kotel_oshibka_kotla') }}\n"
    action: notify.gHA
- id: '1721934904885'
  alias: lw02 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.lw02
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: light.lampochka_2
    state: 'on'
  action:
  - action: automation.trigger
    data:
      skip_condition: false
    target:
      entity_id: automation.lw2_on_off
  mode: single
- id: '1721935764273'
  alias: Lw02 On - tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.lampochka_2
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  condition: []
  action:
  - action: timer.cancel
    target:
      entity_id: timer.lw02
    data: {}
  - action: timer.start
    target:
      entity_id: timer.lw02
    data: {}
  mode: single
- id: '1722072867693'
  alias: Etk2 On
  description: ''
  triggers:
  - entity_id:
    - sensor.kotel_kotel
    to:
    for:
      hours: 0
      minutes: 3
      seconds: 0
    enabled: false
    trigger: state
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: switch.klimat_etk2
      state: 'on'
  actions:
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      device_id: de3479aa9a795fa6ce56956a2233bc36
  - metadata: {}
    data: {}
    target:
      entity_id: switch.klimat_etk2
    action: switch.turn_on
  - metadata: {}
    data: {}
    target:
      entity_id: switch.klimat_etk
    action: switch.turn_off
  - metadata: {}
    data: {}
    target:
      entity_id: switch.klimat_pid
    action: switch.turn_off
  - wait_for_trigger: []
    timeout:
      hours: 0
      minutes: 0
      seconds: 22
      milliseconds: 0
    continue_on_timeout: true
  - data:
      title: Контроллер
      message: 'GIST  {{ states(''switch.klimat_gist'') }}

        ETK  {{ states(''switch.klimat_etk'') }}

        ETK2  {{ states(''switch.klimat_etk2'') }}

        PID  {{ states(''switch.klimat_pid'') }}

        '
      data:
        disable_notification: true
    action: notify.gHA
  mode: single
- id: '1722105592543'
  alias: Boiler Gorelka Sens On/Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.kotel_gorelka
    from: "\U0001F525работает"
    to: ➖
    for:
      hours: 0
      minutes: 0
      seconds: 1
  - platform: state
    entity_id:
    - sensor.kotel_gorelka
    from: ➖
    to: "\U0001F525работает"
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition: []
  action:
  - if:
    - condition: state
      entity_id: light.lz01
      state: 'on'
    then:
    - if:
      - condition: state
        entity_id: sensor.kotel_goriachaia_voda
        state: 'on'
      then:
      - if:
        - condition: state
          entity_id: sensor.kotel_gorelka
          state: "\U0001F525работает"
        then:
        - action: timer.pause
          metadata: {}
          data: {}
          target:
            entity_id: timer.lz01
        - action: light.turn_on
          metadata: {}
          data:
            kelvin: 6500
            brightness_pct: 80
            transition: 3
          target:
            device_id: b719ed1e31d7c898470e7fc10d438b3e
      - if:
        - condition: state
          entity_id: sensor.kotel_gorelka
          state: ➖
        then:
        - action: light.turn_on
          metadata: {}
          data:
            kelvin: 2000
            brightness_pct: 80
            transition: 3
          target:
            device_id: b719ed1e31d7c898470e7fc10d438b3e
        - action: timer.finish
          metadata: {}
          data: {}
          target:
            entity_id: timer.lz01
        - action: timer.start
          metadata: {}
          data: {}
          target:
            entity_id: timer.lz01
    - if:
      - condition: state
        entity_id: sensor.kotel_goriachaia_voda
        state: 'off'
      - condition: state
        entity_id: sensor.kotel_gorelka
        state: ➖
      then:
      - action: light.turn_on
        metadata: {}
        data:
          kelvin: 2000
          brightness_pct: 50
        target:
          device_id: b719ed1e31d7c898470e7fc10d438b3e
      - action: timer.finish
        metadata: {}
        data: {}
        target:
          entity_id: timer.lz01
      - action: timer.start
        metadata: {}
        data: {}
        target:
          entity_id: timer.lz01
  - if:
    - condition: or
      conditions:
      - condition: state
        entity_id: light.lampochka_3
        state: 'off'
      - condition: and
        conditions:
        - condition: state
          entity_id: light.lampochka_3
          state: 'on'
        - condition: state
          entity_id: light.lampochka_3
          attribute: color_mode
          state: hs
        - condition: numeric_state
          entity_id: light.lampochka_3
          attribute: brightness
          below: 17
          enabled: true
    then:
    - if:
      - condition: state
        state: ✅
        entity_id: sensor.kotel_otoplenie
        enabled: true
      then:
      - if:
        - condition: state
          entity_id: sensor.kotel_gorelka
          state: "\U0001F525работает"
        then:
        - action: light.turn_on
          metadata: {}
          data:
            brightness_pct: 5
            transition: 3
            rgb_color:
            - 225
            - 0
            - 255
          target:
            entity_id: light.lampochka_3
        - delay:
            hours: 0
            minutes: 0
            seconds: 4
            milliseconds: 0
        - action: timer.pause
          metadata: {}
          data: {}
          target:
            entity_id: timer.lw03
      - if:
        - condition: state
          entity_id: sensor.kotel_gorelka
          state: ➖
        then:
        - action: light.turn_on
          metadata: {}
          data:
            brightness_pct: 5
            transition: 3
            rgb_color:
            - 0
            - 255
            - 0
          target:
            entity_id: light.lampochka_3
        - delay:
            hours: 0
            minutes: 0
            seconds: 4
            milliseconds: 0
        - action: timer.pause
          metadata: {}
          data: {}
          target:
            entity_id: timer.lw03
    - if:
      - condition: state
        state: ➖
        entity_id: sensor.kotel_otoplenie
        enabled: true
      then:
      - if:
        - condition: state
          entity_id: sensor.kotel_gorelka
          state: "\U0001F525работает"
        then:
        - action: light.turn_on
          metadata: {}
          data:
            brightness_pct: 5
            transition: 3
            rgb_color:
            - 225
            - 255
            - 0
          target:
            entity_id: light.lampochka_3
        - delay:
            hours: 0
            minutes: 0
            seconds: 4
            milliseconds: 0
        - action: timer.pause
          metadata: {}
          data: {}
          target:
            entity_id: timer.lw03
      - if:
        - condition: state
          entity_id: sensor.kotel_gorelka
          state: ➖
        then:
        - action: light.turn_on
          metadata: {}
          data:
            brightness_pct: 5
            transition: 3
            rgb_color:
            - 0
            - 0
            - 255
          target:
            entity_id: light.lampochka_3
        - delay:
            hours: 0
            minutes: 0
            seconds: 4
            milliseconds: 0
        - action: timer.start
          target:
            entity_id:
            - timer.lw03
          data: {}
  mode: single
- id: '1722107322243'
  alias: Tr01 Err - Tg msg
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.tr01_temperature
    to: unavailable
    for:
      hours: 0
      minutes: 3
      seconds: 5
  - platform: state
    entity_id:
    - sensor.tr01_temperature
    to: unknown
    for:
      hours: 0
      minutes: 3
      seconds: 5
  condition: []
  action:
  - data:
      title: Датчик температуры
      message: 'состояние - {{ states(''sensor.tr01_temperature'') }} '
    action: notify.gHA
  mode: single
- id: '1722109190602'
  alias: 1-Start
  description: Сервер УД запущен
  triggers:
  - event: start
    trigger: homeassistant
  conditions: []
  actions:
  - action: notify.me
    data:
      title: "\U0001F4E1 HA Start"
      message: "\U0001FAE5 - {{ states('sensor.time') }}    \n"
      data:
        disable_notification: true
    enabled: true
  - action: notify.gHA
    data:
      title: "\U0001F4E1 HA Старт"
      message: "\U0001FAE5 - {{ states('sensor.time') }}    \n"
      data:
        disable_notification: true
    enabled: false
  - delay:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
    enabled: true
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.lamptest
  - action: automation.trigger
    target:
      entity_id: automation.ts54_on
    data:
      skip_condition: true
  - action: automation.trigger
    target:
      entity_id:
      - automation.ts2_preset
    data:
      skip_condition: false
  - action: automation.trigger
    target:
      entity_id:
      - automation.tr2_21_25_tg_msg
    data:
      skip_condition: true
  mode: single
- id: '1722581467485'
  alias: Cam ND - Tg msg
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.nvt_cell_motion_detection
    from: 'on'
    for:
      hours: 3
      minutes: 0
      seconds: 0
  condition:
  - condition: state
    entity_id: binary_sensor.tod_foll_day
    for:
      hours: 0
      minutes: 0
      seconds: 5
    state: 'on'
  action:
  - data:
      message: Датчик камеры неактивен {{ relative_time(states.binary_sensor.nvt_cell_motion_detection.last_changed)
        }}
    action: notify.gHA
  mode: single
- id: '1723319157849'
  alias: lw03 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.lw03
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: light.lampochka_3
    state: 'on'
  action:
  - action: automation.trigger
    target:
      entity_id:
      - automation.lw3_on_off
    data:
      skip_condition: false
  mode: single
- id: '1723319608529'
  alias: Lw3 - tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - light.lampochka_3
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  condition: []
  action:
  - action: timer.cancel
    target:
      entity_id: timer.lw03
    data: {}
  - action: timer.start
    target:
      entity_id: timer.lw03
    data: {}
  mode: single
- id: '1723394894780'
  alias: ds02 LongOpen - Tg msg
  description: ворота открыты больше положенного времени
  triggers:
  - entity_id:
    - timer.ds02
    for:
      hours: 0
      minutes: 0
      seconds: 1
    to: idle
    from: active
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.ds02_contact
    state: 'on'
  actions:
  - data:
      title: ⛩ Ворота
      message: "открыты больше положенного времени\n{{ relative_time(state_attr('automation.ds02_tg_msg_3',
        'last_triggered')) | replace(\"hours\", \"час.\", 1) | replace(\"hour\", \"час.\",
        1) | replace(\"minutes\", \"мин.\", 1) }}\n{{ states('sensor.ds02_illuminance')
        }} ⌚️ {{ states('sensor.time') }}   \n"
    action: notify.gHA
  mode: single
- id: '1723397791958'
  alias: Ds01 Bat
  description: ''
  trigger:
  - type: battery_level
    platform: device
    device_id: f100d4ef0ff487cdafc78596c3a9409a
    entity_id: 86466e84f2b575bee0d78d48ed34f57a
    domain: sensor
    below: 100
    for:
      hours: 0
      minutes: 0
      seconds: 5
  condition: []
  action:
  - data:
      title: Датчик открытия
      message: "\U0001FAAB Батарейка Ds01 -  {{ states('sensor.ds01_battery') }} "
    action: notify.gHA
  mode: single
- id: '1723397806273'
  alias: Ds02 Bat
  description: ''
  trigger:
  - type: battery_level
    platform: device
    device_id: dc540e71118bca0ea3a68f32bbe2793b
    entity_id: 96a34071131d30b44e471ec2bc606830
    domain: sensor
    below: 100
    for:
      hours: 0
      minutes: 0
      seconds: 5
  condition: []
  action:
  - data:
      message: 'Батарейка Ds02 -  {{ states(''sensor.0xa4c138147e86276f_battery'')
        }} '
    action: notify.gHA
  mode: single
- id: '1723435591077'
  alias: Boiler Otoplenie Swch On/Off - Tg msg
  description: Ошибка подключения контроллера
  trigger:
  - platform: state
    entity_id:
    - switch.kotel_otoplenie
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 10
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: sensor.kotel_otoplenie
      state: unknown
    - condition: state
      entity_id: sensor.kotel_otoplenie
      state: unavailable
    - condition: state
      entity_id: sensor.kotel_otoplenie
      state: ➖
    - condition: state
      entity_id: sensor.kotel_otoplenie
      state: '"..."'
  action:
  - data:
      title: ⁉️ Контроллер
      message: 'Нет согласования, Отопление

        Статус {{ states(''sensor.kotel_otoplenie'') }}

        Задано {{ states(''switch.kotel_otoplenie'') }}

        '
    action: notify.gHA
  mode: single
- id: '1723451166787'
  alias: Tg kotel_restart
  description: ''
  triggers:
  - event_type: telegram_command
    event_data:
      command: /kotel_r
    context: {}
    trigger: event
  conditions: []
  actions:
  - data:
      message: Сброс питания котла -  {{ states('sensor.kotel_otopleniia') }}
    action: notify.gHA
  - data:
      message: 'Сброс питания котла -  {{ states(''sensor.kotel_otopleniia'') }} '
    action: notify.me
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.kotel_test_otklika
  mode: single
- id: '1723484792938'
  alias: Boiler GVS Sens On/Off - Tg msg
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.kotel_goriachaia_voda
    to: ✅
    from: ➖
    for:
      hours: 0
      minutes: 0
      seconds: 3
  - platform: state
    entity_id:
    - sensor.kotel_goriachaia_voda
    from: ✅
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: ➖
  condition: []
  action:
  - if:
    - condition: state
      entity_id: sensor.kotel_goriachaia_voda
      state: ✅
    then:
    - if:
      - condition: state
        entity_id: switch.kotel_gvs
        state: 'off'
      then:
      - data:
          title: ⁉️ Контроллер
          message: 'Нет согласования, ГВС

            Статус {{ states(''sensor.kotel_goriachaia_voda'') }}

            Задано {{ states(''switch.kotel_gvs'') }}

            '
        action: notify.gHA
  - if:
    - condition: state
      entity_id: sensor.kotel_goriachaia_voda
      state: ➖
    then:
    - if:
      - condition: state
        entity_id: switch.kotel_gvs
        state: 'on'
      then:
      - data:
          title: ⁉️ Контроллер
          message: 'Нет согласования, ГВС

            Статус {{ states(''sensor.kotel_goriachaia_voda'') }}

            Задано {{ states(''switch.kotel_gvs'') }}

            '
        action: notify.gHA
  - data:
      title: Горячяя вода {{ states('sensor.kotel_goriachaia_voda') }}
      message: "\U0001F321 ГВС {{ states('sensor.kotel_goriachei_vody') }}\n\U0001F321
        СО {{ states('sensor.kotel_otopleniia') }}\n"
      data:
        disable_notification: true
    action: notify.gHA
  mode: single
- id: '1723485524716'
  alias: Boiler Test
  description: Котёл тест отклика
  trigger:
  - platform: state
    entity_id:
    - number.klimat_otoplenie_max
    to: '88.8'
    for:
      hours: 0
      minutes: 0
      seconds: 11
  condition:
  - condition: state
    entity_id: sensor.kotel_kotel
    state: ✅
  - condition: not
    conditions:
    - condition: state
      entity_id: sensor.kotel_goriachaia_voda
      state: ✅
    - condition: state
      entity_id: sensor.kotel_otoplenie
      state: ✅
    - condition: state
      entity_id: sensor.kotel_gorelka
      state: "\U0001F525работает"
  action:
  - metadata: {}
    data: {}
    target:
      entity_id: switch.kotel_otoplenie
    action: switch.turn_on
  - delay:
      hours: 0
      minutes: 0
      seconds: 7
      milliseconds: 0
  - metadata: {}
    data: {}
    target:
      entity_id: switch.kotel_otoplenie
    action: switch.turn_off
  - device_id: ea950932245b5733fe0d30e68fbca21b
    domain: number
    entity_id: 2fcdaff632f9b202d362d5c52be9cdbc
    type: set_value
    value: 22.2
  - if:
    - condition: state
      entity_id: sensor.kotel_otoplenie
      state: ➖
      for:
        hours: 0
        minutes: 0
        seconds: 13
    then:
    - device_id: ea950932245b5733fe0d30e68fbca21b
      domain: number
      entity_id: 2fcdaff632f9b202d362d5c52be9cdbc
      type: set_value
      value: 99.9
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.boiler_reset
      enabled: false
  mode: single
- id: '1723486104669'
  alias: Tr01 14/22 - Tg msg
  description: ''
  triggers:
  - entity_id:
    - sensor.tr01_temperature
    for:
      hours: 0
      minutes: 0
      seconds: 5
    above: 22
    trigger: numeric_state
  - entity_id:
    - sensor.tr01_temperature
    for:
      hours: 0
      minutes: 0
      seconds: 5
    below: 14
    trigger: numeric_state
  conditions:
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.tr01_temperature
      above: 22
    - condition: numeric_state
      entity_id: sensor.tr01_temperature
      below: 14
  actions:
  - data:
      title: ⁉️ Датчик кор за пределами
      message: "\U0001F4DF Котёл {{ states('sensor.kotel_kotel') }}\n\U0001F321 зал
        {{ states('sensor.tr2_temperature') }}\n\U0001F321 кор {{ states('sensor.tr01_temperature')
        }}\n\U0001F321 сени {{ states('sensor.klimat_seni1_t1') }}\n\U0001F321 ул
        {{ states('sensor.kotel_ulitsa_k') }}\n\U0001F321 ГВС {{ states('sensor.kotel_goriachei_vody')
        }}\n\U0001F321 СО {{ states('sensor.kotel_otopleniia') }}\n\U0001F6B0 Горячая
        вода {{ states('sensor.kotel_goriachaia_voda') }}\n♻️ Отопление {{ states('sensor.kotel_otoplenie')
        }}\n\U0001F39B Отопление {{ states('switch.kotel_otoplenie') }}\n\U0001F39B
        Горячая вода {{ states('switch.kotel_gvs') }}\n"
    action: notify.gHA
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.tr01_21_25_tg_mess
  mode: single
- id: '1723531923222'
  alias: Boiler NA or Off - Tg msg
  description: ''
  triggers:
  - entity_id:
    - sensor.kotel_kotel
    for:
      hours: 0
      minutes: 5
      seconds: 5
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.kotel_kotel
        state: ❌
      - condition: state
        entity_id: sensor.kotel_kotel
        state: unavailable
        for:
          hours: 0
          minutes: 0
          seconds: 0
      - condition: state
        entity_id: sensor.kotel_kotel
        state: unknown
        for:
          hours: 0
          minutes: 0
          seconds: 0
      enabled: false
    - condition: template
      value_template: '{{ not is_state(''sensor.kotel_kotel'', ''✅'') }}'
    then:
    - data:
        title: Котёл
        message: "статус: {{ states('sensor.kotel_kotel') }} \n"
        data:
          disable_notification: false
      action: notify.gHA
  - if:
    - condition: state
      entity_id: sensor.kotel_kotel
      state: ✅
      enabled: false
    - condition: template
      value_template: '{{ is_state(''sensor.kotel_kotel'', ''✅'') }}'
    then:
    - action: automation.trigger
      target:
        entity_id: automation.ts54_on
      data:
        skip_condition: false
  mode: single
- id: '1723637212944'
  alias: Ds02 lx - Tg
  description: Освещение поменялось
  triggers:
  - entity_id:
    - sensor.ds02_illuminance
    for:
      hours: 0
      minutes: 0
      seconds: 5
    trigger: state
  conditions:
  - condition: numeric_state
    entity_id: sensor.ds02_illuminance
    above: 0
    below: 2000
  - condition: state
    entity_id: timer.ds02_lx
    state: idle
  actions:
  - action: notify.gHA
    data:
      title: Гараж
      message: "\U0001F4A1 {{ states('sensor.ds02_illuminance') }}\n⌚️ {{ states('sensor.time')
        }}\n"
      data:
        disable_notification: true
  mode: single
- id: '1723639536263'
  alias: Ms3 Bat - Tg
  description: ''
  trigger:
  - type: battery_level
    platform: device
    device_id: 4f7476725d9dceb90bdbd305516fc45b
    entity_id: b68eef014219e549a8f522e3cf82af73
    domain: sensor
    below: 100
    for:
      hours: 0
      minutes: 0
      seconds: 5
  condition: []
  action:
  - data:
      message: "\U0001FAAB Батарейка Ms3 -  {{ states('sensor.Ms3_battery') }} "
    action: notify.gHA
  mode: single
- id: '1723818753508'
  alias: Cam270 - Lw1 On
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.nvt_cell_motion_detection
    for:
      hours: 0
      minutes: 0
      seconds: 0
  condition:
  - condition: state
    entity_id: binary_sensor.nvt_cell_motion_detection
    state: 'on'
  action:
  - if:
    - condition: device
      type: is_off
      device_id: 7200186a7aabfb3a8a39005a3897fc4e
      entity_id: ab163e9252cdf74dbd203b72549bfe90
      domain: light
    - condition: state
      entity_id: binary_sensor.tod_night
      state: 'on'
    then:
    - metadata: {}
      data:
        brightness_pct: 5
        rgb_color:
        - 255
        - 255
        - 0
      target:
        entity_id:
        - light.lampochka_1
      action: light.turn_on
  - if:
    - condition: device
      type: is_off
      device_id: 7200186a7aabfb3a8a39005a3897fc4e
      entity_id: ab163e9252cdf74dbd203b72549bfe90
      domain: light
    - condition: state
      entity_id: binary_sensor.tod_foll_night
      state: 'on'
    - condition: state
      entity_id: binary_sensor.tod_night
      state: 'off'
    then:
    - metadata: {}
      data:
        brightness_pct: 10
        kelvin: 3333
      target:
        entity_id: light.lampochka_1
      action: light.turn_on
  - if:
    - condition: device
      type: is_on
      device_id: 7200186a7aabfb3a8a39005a3897fc4e
      entity_id: ab163e9252cdf74dbd203b72549bfe90
      domain: light
    then:
    - data: {}
      target:
        entity_id: timer.lw01
      action: timer.cancel
    - data: {}
      target:
        entity_id: timer.lw01
      action: timer.start
  - action: timer.cancel
    metadata: {}
    data: {}
    target:
      entity_id: timer.cam270
  - action: timer.start
    metadata: {}
    data: {}
    target:
      entity_id: timer.cam270
  mode: single
- id: '1723904754721'
  alias: 8-sec
  description: ''
  trigger:
  - platform: time_pattern
    seconds: '8'
  condition: []
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.ts54_on
    enabled: false
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.ms03_lw3_on
    enabled: false
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.pir01_l2_on
    enabled: false
  mode: single
- id: '1723919654731'
  alias: Cam8 ND - Tg msg
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.cam8_cell_motion_detection
    from: 'on'
    for:
      hours: 3
      minutes: 0
      seconds: 0
  condition:
  - condition: state
    entity_id: binary_sensor.tod_foll_day
    for:
      hours: 0
      minutes: 0
      seconds: 5
    state: 'on'
  action:
  - data:
      message: Датчик камеры неактивен {{ relative_time(states.binary_sensor.cam8_cell_motion_detection.last_changed)
        }}
    action: notify.gHA
  mode: single
- id: '1724094444011'
  alias: Xs1 i3 - Off
  description: Смарт почти заряжен, но не снят с зарядного
  trigger:
  - platform: state
    entity_id:
    - sensor.xs1_current
    attribute: current
    to: '0.021'
    for:
      hours: 0
      minutes: 5
      seconds: 5
  condition: []
  action:
  - type: turn_off
    device_id: 248486f1c4384b6b1c68e5549574e919
    entity_id: 6fdf8b7a83e61c2917176164af745dd3
    domain: switch
  - data: {}
    target:
      entity_id: timer.xs1
    action: timer.cancel
  - data: {}
    target:
      entity_id: timer.xs1
    action: timer.start
  mode: single
- id: '1724121363622'
  alias: B1k L
  description: ''
  trigger:
  - platform: device
    domain: mqtt
    device_id: 814dcc4c7f838f1f70d1e038af08f51a
    type: action
    subtype: hold
  condition: []
  action:
  - if:
    - condition: device
      type: is_off
      device_id: 2519fe869b93b107ae307fed766beb9f
      entity_id: 45e4e03ecee12bea76a563c6149bdbc7
      domain: light
    then:
    - action: light.turn_on
      target:
        device_id:
        - 2519fe869b93b107ae307fed766beb9f
      data:
        kelvin: 6500
        brightness_pct: 100
  - if:
    - condition: numeric_state
      entity_id: light.lampochka_3
      below: 80
      attribute: brightness
    then:
    - action: light.turn_on
      target:
        device_id:
        - 2519fe869b93b107ae307fed766beb9f
      data:
        kelvin: 6500
        brightness_pct: 100
  - if:
    - condition: numeric_state
      entity_id: light.lampochka_3
      above: 90
      attribute: brightness
    then:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        device_id: 2519fe869b93b107ae307fed766beb9f
    - data: {}
      target:
        entity_id: timer.lw03
      action: timer.cancel
  mode: single
- id: '1724157240251'
  alias: LampTest
  description: ''
  trigger:
  - platform: homeassistant
    event: start
    enabled: false
  condition: []
  action:
  - if:
    - condition: state
      entity_id: light.lampochka_1
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    - condition: state
      entity_id: timer.lw01
      state: idle
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id:
        - automation.lw1_on_tim
  - if:
    - condition: state
      entity_id: light.lampochka_2
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - condition: state
      entity_id: timer.lw02
      state: idle
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.lw02_on
  - if:
    - condition: state
      entity_id: light.lampochka_3
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - condition: state
      entity_id: timer.lw03
      state: idle
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.lw03_on
  - if:
    - condition: state
      entity_id: light.lz01
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 1
    - condition: state
      entity_id: timer.lz01
      state: idle
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id:
        - automation.lz01_on_off
  mode: single
- id: '1724328582716'
  alias: 8-min
  description: ''
  triggers:
  - minutes: '8'
    trigger: time_pattern
  conditions: []
  actions:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.lamptest
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.n_hour
    enabled: false
  mode: single
- id: '1724337718722'
  alias: Tr2 Err -Tg nsg
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.tr2_temperature
    to: unavailable
    for:
      hours: 0
      minutes: 3
      seconds: 5
  - platform: state
    entity_id:
    - sensor.tr2_temperature
    to: unknown
    for:
      hours: 0
      minutes: 3
      seconds: 5
  condition: []
  action:
  - data:
      title: Датчик температуры 2
      message: 'состояние - {{ states(''sensor.tr2_temperature'') }} '
    action: notify.gHA
  mode: single
- id: '1724567938543'
  alias: ETK On
  description: ''
  triggers:
  - entity_id:
    - sensor.kotel_kotel
    to:
    for:
      hours: 0
      minutes: 3
      seconds: 0
    enabled: false
    trigger: state
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: switch.klimat_etk
      state: 'on'
  actions:
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      device_id: de3479aa9a795fa6ce56956a2233bc36
  - metadata: {}
    data: {}
    action: switch.turn_on
    target:
      entity_id: switch.klimat_etk
  - metadata: {}
    data: {}
    action: switch.turn_off
    target:
      entity_id: switch.klimat_etk2
  - metadata: {}
    data: {}
    target:
      entity_id: switch.klimat_pid
    action: switch.turn_off
  - wait_for_trigger: []
    timeout:
      hours: 0
      minutes: 0
      seconds: 22
      milliseconds: 0
    continue_on_timeout: true
  - data:
      title: Контроллер
      message: 'GIST  {{ states(''switch.klimat_gist'') }}

        ETK  {{ states(''switch.klimat_etk'') }}

        ETK2  {{ states(''switch.klimat_etk2'') }}

        PID  {{ states(''switch.klimat_pid'') }}

        '
      data:
        disable_notification: true
    action: notify.gHA
  mode: single
- id: '1724610451944'
  alias: TSA On/Off
  description: ''
  triggers:
  - entity_id:
    - switch.switch_tsa
    for:
      hours: 0
      minutes: 0
      seconds: 3
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: timer.tsa
      state: active
    then:
    - action: timer.pause
      target:
        entity_id:
        - timer.tsa
      data: {}
  - if:
    - condition: state
      entity_id: switch.switch_tsa
      state: 'on'
    then:
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: switch.klimat_etk
          state: 'on'
      then:
      - metadata: {}
        data:
          skip_condition: false
        action: automation.trigger
        target:
          entity_id: automation.etk_on
        enabled: true
      enabled: true
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: switch.klimat_etk2
          state: 'on'
      then:
      - metadata: {}
        data:
          skip_condition: false
        target:
          entity_id: automation.etk2
        action: automation.trigger
        enabled: true
      enabled: false
    - metadata: {}
      data: {}
      target:
        entity_id: switch.klimat_gist
      action: switch.turn_off
    - delay:
        hours: 0
        minutes: 0
        seconds: 1
        milliseconds: 0
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: switch.klimat_gist
          state: 'off'
      then:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.tsa
      - action: timer.start
        metadata: {}
        data: {}
        target:
          entity_id: timer.tsa
  - if:
    - condition: state
      entity_id: switch.switch_tsa
      state: 'off'
    then:
    - metadata: {}
      data: {}
      target:
        entity_id: switch.klimat_gist
      action: switch.turn_on
    - delay:
        hours: 0
        minutes: 0
        seconds: 1
        milliseconds: 0
    - if:
      - condition: not
        conditions:
        - condition: state
          entity_id: switch.klimat_gist
          state: 'on'
      then:
      - action: timer.cancel
        metadata: {}
        data: {}
        target:
          entity_id: timer.tsa
      - action: timer.start
        metadata: {}
        data: {}
        target:
          entity_id: timer.tsa
  mode: single
- id: '1724782738181'
  alias: Sw4k1 On/Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.sw4k_l1
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  - platform: state
    entity_id:
    - switch.sw4k_l1
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  condition: []
  action:
  - if:
    - condition: state
      entity_id: switch.sw4k_l1
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: timer.ms3
        state: active
      - condition: state
        entity_id: timer.ms4
        state: active
    then:
    - action: timer.cancel
      data: {}
      target:
        entity_id: timer.sw4k1
    - action: timer.start
      data: {}
      target:
        entity_id: timer.sw4k1
  - if:
    - condition: state
      entity_id: switch.sw4k_l1
      state: 'off'
    then:
    - action: timer.cancel
      data: {}
      target:
        entity_id: timer.sw4k1
  mode: single
- id: '1724783348612'
  alias: Sw4k2 On/Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.sw4k_l2
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  - platform: state
    entity_id:
    - switch.sw4k_l2
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  condition: []
  action:
  - if:
    - condition: state
      entity_id: switch.sw4k_l2
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: timer.ms3
        state: active
      - condition: state
        entity_id: timer.ms4
        state: active
    then:
    - action: timer.cancel
      data: {}
      target:
        entity_id: timer.sw4k2
    - action: timer.start
      data: {}
      target:
        entity_id: timer.sw4k2
  - if:
    - condition: state
      entity_id: switch.sw4k_l2
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: timer.ms4
        state: active
      - condition: state
        entity_id: timer.ds01
        state: active
    then:
    - action: switch.turn_on
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l2
  - if:
    - condition: state
      entity_id: switch.sw4k_l2
      state: 'off'
    - condition: state
      entity_id: timer.ms4
      state: idle
    - condition: state
      entity_id: timer.ds01
      state: idle
    then:
    - action: timer.cancel
      data: {}
      target:
        entity_id: timer.sw4k2
  mode: single
- id: '1724783369798'
  alias: Sw4k3 On/Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.sw4k_l3
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  - platform: state
    entity_id:
    - switch.sw4k_l3
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  condition: []
  action:
  - if:
    - condition: state
      entity_id: switch.sw4k_l3
      state: 'on'
    - condition: state
      entity_id: timer.ms3
      state: active
    then:
    - action: timer.cancel
      data: {}
      target:
        entity_id: timer.sw4k3
    - action: timer.start
      data: {}
      target:
        entity_id: timer.sw4k3
  - if:
    - condition: state
      entity_id: switch.sw4k_l3
      state: 'off'
    then:
    - action: timer.cancel
      data: {}
      target:
        entity_id: timer.sw4k3
  mode: single
- id: '1724783387194'
  alias: Sw4k4 On/Off
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.sw4k_l4
    to: 'off'
    from: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  condition: []
  action:
  - if:
    - condition: state
      entity_id: switch.sw4k_l4
      state: 'on'
    - condition: state
      entity_id: timer.ms3
      state: active
    then:
    - action: timer.cancel
      data: {}
      target:
        entity_id: timer.sw4k4
    - action: timer.start
      data: {}
      target:
        entity_id: timer.sw4k4
  - if:
    - condition: state
      entity_id: switch.sw4k_l4
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: timer.sw4k4
        state: active
    then:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l4
  - if:
    - condition: state
      entity_id: switch.sw4k_l4
      state: 'off'
    then:
    - action: timer.cancel
      data: {}
      target:
        entity_id: timer.sw4k4
  mode: single
- id: '1724783511200'
  alias: sw4k1 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.sw4k1
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: switch.sw4k_l1
    state: 'on'
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.sw4k1_on_off
  mode: single
- &id001
  id: '1724783854823'
  alias: sw4k2 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.sw4k2
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: switch.sw4k_l2
    state: 'on'
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.sw4k2_on_off
  mode: single
- *id001
- id: '1724783937130'
  alias: sw4k3 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.sw4k3
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: switch.sw4k_l3
    state: 'on'
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.sw4k3_on_off
  mode: single
- id: '1724783953111'
  alias: sw4k4 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.sw4k4
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: switch.sw4k_l4
    state: 'on'
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.sw4k4_on_off
  mode: single
- id: '1724864702285'
  alias: B6k Click
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.b6k_action
  condition: []
  action:
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 1_single
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l1
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 2_single
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.xs3
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 3_single
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l2
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 4_single
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l3
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 5_single
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.xs6
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 6_single
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l4
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 1_double
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l1
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 2_double
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.xs3
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 3_double
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l2
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 4_double
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l3
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 5_double
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.xs6
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 6_double
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l4
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 1_hold
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l1
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 2_hold
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.xs3
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 3_hold
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l2
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 4_hold
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l3
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 5_hold
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.xs6
  - if:
    - condition: state
      entity_id: sensor.b6k_action
      state: 6_hold
      attribute: action
    then:
    - action: switch.toggle
      metadata: {}
      data: {}
      target:
        entity_id: switch.sw4k_l4
  mode: single
- id: '1725031180093'
  alias: Git Push
  description: ''
  trigger:
  - platform: time
    at: 05:55:55
    enabled: false
  condition: []
  action:
  - action: hassio.addon_stdin
    metadata: {}
    data:
      addon: a0d7b954_ssh
      input: /config/ha_gitpush.sh
    enabled: false
  - action: shell_command.call_gitpush
    enabled: true
  mode: single
- id: '1725204137212'
  alias: Xs7 On/Off
  description: Включим свет при обнаружении ночью
  trigger:
  - platform: state
    entity_id:
    - switch.xs7
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: 'on'
    enabled: false
  - platform: state
    entity_id:
    - switch.xs7
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: 'off'
    enabled: false
  condition: []
  action:
  - if:
    - condition: state
      entity_id: switch.xs7
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.ms4_illuminance
      below: 2000
    - condition: or
      conditions:
      - condition: state
        entity_id: timer.ms4
        state: active
      - condition: state
        entity_id: timer.ds01
        state: active
    then:
    - action: switch.turn_on
      target:
        entity_id: switch.xs7
      data: {}
  - if:
    - condition: state
      entity_id: switch.xs7
      state: 'off'
    - condition: state
      entity_id: binary_sensor.tod_foll_night
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: timer.ms4
        state: active
      - condition: state
        entity_id: timer.ds01
        state: active
    then:
    - action: switch.turn_on
      target:
        entity_id: switch.xs7
      data: {}
  - if:
    - condition: state
      entity_id: switch.xs7
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: timer.ms4
        state: active
      - condition: state
        entity_id: timer.ds01
        state: active
    then:
    - action: timer.cancel
      target:
        entity_id:
        - timer.xs7
      data: {}
    - action: timer.start
      target:
        entity_id:
        - timer.xs7
      data: {}
  - if:
    - condition: state
      entity_id: timer.xs7
      state: idle
    - condition: state
      entity_id: switch.xs7
      state: 'on'
    then:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.xs7
  mode: single
- id: '1725205800364'
  alias: Ms1 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.ms1
    to: idle
    from: active
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: timer.ms1
    state: active
  action:
  - action: timer.cancel
    target:
      entity_id:
      - timer.ms1
    data: {}
  - action: timer.start
    target:
      entity_id:
      - timer.ms1
    data: {}
  mode: single
- id: '1725206363867'
  alias: Ms4 - tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.ms4_occupancy
    to: 'on'
  condition: []
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.ms4_tim_2
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.ms4_run
  mode: single
- id: '1725207078337'
  alias: ms3 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.ms3
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: binary_sensor.ms3_occupancy
    state: 'on'
  action:
  - action: timer.cancel
    target:
      entity_id: timer.ms3
  - action: timer.start
    target:
      entity_id: timer.ms3
  mode: single
- id: '1725211449544'
  alias: Xs5 On/Off
  description: Включим свет
  trigger:
  - platform: state
    entity_id:
    - switch.xs5
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: 'on'
    enabled: false
  - platform: state
    entity_id:
    - switch.xs5
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: 'off'
    enabled: false
  condition: []
  action:
  - if:
    - condition: state
      entity_id: switch.xs5
      state: 'off'
    - condition: or
      conditions:
      - condition: state
        entity_id: timer.ds02
        state: active
      - condition: and
        conditions:
        - condition: state
          entity_id: timer.ms4
          state: active
        - condition: time
          after: 06:06:06
          before: 06:45:00
    then:
    - action: switch.turn_on
      target:
        entity_id: switch.xs5
      data: {}
  - if:
    - condition: state
      entity_id: switch.xs5
      state: 'on'
    - condition: or
      conditions:
      - condition: state
        entity_id: timer.ds02
        state: active
    then:
    - action: timer.cancel
      target:
        entity_id:
        - timer.xs5
      data: {}
    - action: timer.start
      target:
        entity_id:
        - timer.xs5
      data: {}
  - if:
    - condition: state
      entity_id: switch.xs5
      state: 'on'
    - condition: state
      entity_id: timer.xs5
      state: idle
    then:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.xs5
  mode: single
- id: '1725212162865'
  alias: Ms4 il int
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.ms4_illuminance
    for:
      hours: 0
      minutes: 0
      seconds: 5
  - platform: time
    at: '16:08:08'
  condition: []
  action:
  - if:
    - condition: time
      after: '16:00:00'
    - condition: state
      entity_id: binary_sensor.tod_foll_day
      state: 'on'
    then:
    - device_id: ce80a8f5a79e346ddfd56683cd3f4bf0
      domain: number
      entity_id: 8adb5b9d3cd8958bcac1f6e836de3535
      type: set_value
      value: 10
  - if:
    - condition: state
      entity_id: binary_sensor.tod_foll_night
      state: 'on'
    then:
    - device_id: ce80a8f5a79e346ddfd56683cd3f4bf0
      domain: number
      entity_id: 8adb5b9d3cd8958bcac1f6e836de3535
      type: set_value
      value: 180
  mode: single
- id: '1725241335738'
  alias: xs5 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.xs5
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: switch.xs5
    state: 'on'
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.xs5_on_off
  mode: single
- id: '1725335684916'
  alias: tsa tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.tsa
    to: idle
    from: active
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition: []
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.ts54_on
  mode: single
- id: '1725519787137'
  alias: Boiler GVS Swch On/Off - Tg msg
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.kotel_gvs
    to: 'on'
    from: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  - platform: state
    entity_id:
    - switch.kotel_gvs
    from: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: 'off'
  condition: []
  action:
  - if:
    - condition: state
      entity_id: switch.kotel_gvs
      state: 'off'
    then:
    - if:
      - condition: state
        entity_id: sensor.kotel_goriachaia_voda
        state: ✅
      then:
      - data:
          title: ⁉️ Контроллер
          message: 'Нет согласования, ГВС

            Статус {{ states(''sensor.kotel_goriachaia_voda'') }}

            Задано {{ states(''switch.kotel_gvs'') }}

            '
        action: notify.gHA
  - if:
    - condition: state
      entity_id: switch.kotel_gvs
      state: 'on'
    then:
    - if:
      - condition: state
        entity_id: sensor.kotel_goriachaia_voda
        state: ➖
      then:
      - data:
          title: ⁉️ Контроллер
          message: 'Нет согласования, ГВС

            Статус {{ states(''sensor.kotel_goriachaia_voda'') }}

            Задано {{ states(''switch.kotel_gvs'') }}

            '
        action: notify.gHA
  mode: single
- id: '1725520813967'
  alias: Boiler Reset
  description: Котёл сброс питанием
  triggers:
  - entity_id:
    - number.klimat_otoplenie_max
    to: '99.9'
    for:
      hours: 0
      minutes: 0
      seconds: 11
    enabled: true
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.kotel_gorelka
        state: "\U0001F525работает"
    then:
    - metadata: {}
      data: {}
      action: switch.turn_off
      target:
        entity_id:
        - switch.xs9
        - switch.xs8
    - delay:
        hours: 0
        minutes: 0
        seconds: 5
        milliseconds: 0
    - metadata: {}
      data: {}
      target:
        entity_id:
        - switch.xs8
      action: switch.turn_on
    - wait_for_trigger:
      - trigger: template
        value_template: '{{ not is_state(''sensor.kotel_kotel'', ''✅'') and not is_state(''sensor.kotel_kotel'',
          ''❌'') }}'
      timeout:
        hours: 0
        minutes: 0
        seconds: 30
        milliseconds: 0
    - delay:
        hours: 0
        minutes: 0
        seconds: 1
        milliseconds: 0
    - wait_for_trigger:
      - trigger: template
        value_template: '{{ is_state(''sensor.kotel_kotel'', ''✅'') or is_state(''sensor.kotel_kotel'',
          ''❌'') }}'
      timeout:
        hours: 0
        minutes: 0
        seconds: 30
        milliseconds: 0
    - metadata: {}
      data: {}
      target:
        entity_id:
        - switch.xs9
      action: switch.turn_on
    - device_id: ea950932245b5733fe0d30e68fbca21b
      domain: number
      entity_id: 2fcdaff632f9b202d362d5c52be9cdbc
      type: set_value
      value: 44.8
  mode: single
- id: '1725642188012'
  alias: Cam270 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.cam270
    from: active
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition: []
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.ms03_lw3_on
  mode: single
- id: '1725652650166'
  alias: Sw4k3 On - tim
  description: Запуск таймера при включении выключателя
  trigger:
  - platform: state
    entity_id:
    - switch.sw4k_l3
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition: []
  action:
  - action: timer.cancel
    data: {}
    target:
      entity_id: timer.sw4k3
  - action: timer.start
    data: {}
    target:
      entity_id: timer.sw4k3
  mode: single
- id: '1725700702051'
  alias: Sw4k4 - tim
  description: Запуск таймера при включении выключателя
  trigger:
  - platform: state
    entity_id:
    - switch.sw4k_l4
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  condition: []
  action:
  - action: timer.cancel
    data: {}
    target:
      entity_id: timer.sw4k4
  - action: timer.start
    data: {}
    target:
      entity_id: timer.sw4k4
  mode: single
- id: '1725716625932'
  alias: Sw4k2 On - tim
  description: Запуск таймера при включении выключателя
  trigger:
  - platform: state
    entity_id:
    - switch.sw4k_l2
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 2
  condition: []
  action:
  - action: timer.cancel
    data: {}
    target:
      entity_id: timer.sw4k2
  - action: timer.start
    data: {}
    target:
      entity_id: timer.sw4k2
  mode: single
- id: '1725716681716'
  alias: Sw4k1 On - tim
  description: Запуск таймера при включении выключателя
  trigger:
  - platform: state
    entity_id:
    - switch.sw4k_l1
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition: []
  action:
  - action: timer.cancel
    data: {}
    target:
      entity_id: timer.sw4k1
  - action: timer.start
    data: {}
    target:
      entity_id: timer.sw4k1
  mode: single
- id: '1725718325954'
  alias: Lw1 On - tim
  description: Запуск таймера при включении лампы
  trigger:
  - platform: state
    entity_id:
    - light.lampochka_1
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  condition: []
  action:
  - action: timer.cancel
    data: {}
    target:
      entity_id: timer.lw01
  - action: timer.start
    data: {}
    target:
      entity_id: timer.lw01
  mode: single
- id: '1725720671721'
  alias: Lz1 On - tim
  description: Запуск таймера при включении лампы
  trigger:
  - platform: state
    entity_id:
    - light.lz01
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 3
  condition: []
  action:
  - action: timer.cancel
    data: {}
    target:
      entity_id: timer.lz01
  - action: timer.start
    data: {}
    target:
      entity_id: timer.lz01
  mode: single
- id: '1725721184571'
  alias: Ms3 - Run
  description: ''
  trigger: []
  condition: []
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.lw3_on_off
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.pris_tim
  mode: single
- id: '1725721729930'
  alias: Ms4 - Run
  description: ''
  trigger: []
  condition: []
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.ms4_xs7_on_off
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.pris_tim
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.xs5_on_off
  mode: single
- id: '1725721982578'
  alias: Xs7 - tim
  description: Включим свет при обнаружении ночью
  trigger:
  - platform: state
    entity_id:
    - switch.xs7
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: 'on'
  condition: []
  action:
  - action: timer.cancel
    target:
      entity_id:
      - timer.xs7
  - action: timer.start
    target:
      entity_id:
      - timer.xs7
  mode: single
- id: '1725723038026'
  alias: Ms4 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.ms4
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: binary_sensor.ms4_occupancy
    state: 'on'
  action:
  - action: timer.cancel
    target:
      entity_id: timer.ms4
  - action: timer.start
    target:
      entity_id: timer.ms4
  mode: single
- id: '1725723631793'
  alias: Ms1 - tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.ms1_occupancy
    to: 'on'
  condition: []
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.ms1_tim
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.ms1_run
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.pris_tim
  mode: single
- id: '1725723902553'
  alias: Ms2 - Run
  description: ''
  trigger: []
  condition: []
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.lw2_on_off
  mode: single
- id: '1725723937021'
  alias: Ms1 - Run
  description: ''
  trigger: []
  condition: []
  action:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: true
    target:
      entity_id: automation.lz01_on_off
  mode: single
- id: '1725777969740'
  alias: ms2 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.ms2
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: binary_sensor.ms2_occupancy
    state: 'on'
  action:
  - action: timer.cancel
    target:
      entity_id:
      - timer.ms2
    data: {}
  - action: timer.start
    target:
      entity_id:
      - timer.ms2
    data: {}
  mode: single
- id: '1725778075643'
  alias: Ms2 - tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.ms2_occupancy
    to: 'on'
  condition: []
  action:
  - action: automation.trigger
    target:
      entity_id:
      - automation.ms2_tim
    data:
      skip_condition: false
  - action: automation.trigger
    target:
      entity_id: automation.ms2_run
    data:
      skip_condition: false
  - action: automation.trigger
    target:
      entity_id:
      - automation.pris_tim
    data:
      skip_condition: false
  mode: single
- id: '1725814008200'
  alias: Lw2 On/Off
  description: ''
  trigger: []
  condition: []
  action:
  - choose:
    - conditions:
      - condition: device
        type: is_off
        device_id: 1aabce343509ada8a0cf550f5252a8a0
        entity_id: 21516f28455701cf8f2c30283f9224f5
        domain: light
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: timer.ms2
            state: idle
          sequence:
          - data: {}
            target:
              entity_id: timer.lw02
            action: timer.cancel
        - conditions:
          - condition: state
            entity_id: timer.ms2
            state: active
          sequence:
          - choose:
            - conditions:
              - condition: state
                entity_id: binary_sensor.tod_foll_night
                state: 'on'
              sequence:
              - target:
                  entity_id: light.lampochka_2
                action: light.turn_on
                data:
                  brightness_pct: 1
                  rgb_color:
                  - 255
                  - 255
                  - 0
            - conditions:
              - condition: state
                entity_id: binary_sensor.tod_foll_night
                state: 'off'
              sequence:
              - target:
                  entity_id: light.lampochka_2
                action: light.turn_on
                data:
                  brightness_pct: 50
                  rgb_color:
                  - 0
                  - 255
                  - 255
            - conditions:
              - condition: state
                entity_id: binary_sensor.tod_day
                state: 'on'
              sequence:
              - target:
                  entity_id: light.lampochka_2
                action: light.turn_on
                data:
                  brightness_pct: 20
                  kelvin: 2505
    - conditions:
      - condition: device
        type: is_on
        device_id: 1aabce343509ada8a0cf550f5252a8a0
        entity_id: 21516f28455701cf8f2c30283f9224f5
        domain: light
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: timer.ms2
            state: active
          sequence:
          - action: timer.cancel
            target:
              entity_id: timer.lw02
            data: {}
          - action: timer.start
            target:
              entity_id: timer.lw02
            data: {}
        - conditions:
          - condition: state
            entity_id: timer.ms2
            state: idle
          - condition: state
            entity_id: timer.lw02
            state: idle
          sequence:
          - action: light.turn_off
            target:
              entity_id: light.lampochka_2
            data: {}
  mode: single
- id: '1725817536368'
  alias: Lw3 On/Off
  description: ''
  trigger: []
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: light.lampochka_3
        state: 'off'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: timer.ms3
            state: active
          sequence:
          - choose:
            - conditions:
              - condition: state
                entity_id: binary_sensor.tod_night
                state: 'on'
              sequence:
              - target:
                  entity_id: light.lampochka_3
                action: light.turn_on
                data:
                  brightness_pct: 10
                  rgb_color:
                  - 0
                  - 255
                  - 255
            - conditions:
              - condition: state
                entity_id: binary_sensor.tod_foll_night_os
                state: 'on'
              - condition: state
                entity_id: timer.sw4k4
                state: idle
              sequence:
              - target:
                  entity_id: light.lampochka_3
                action: light.turn_on
                data:
                  brightness_pct: 20
                  kelvin: 4200
        - conditions:
          - condition: state
            entity_id: timer.ms3
            state: idle
          sequence:
          - action: timer.cancel
            target:
              entity_id: timer.lw03
            data: {}
    - conditions:
      - condition: state
        entity_id: light.lampochka_3
        state: 'on'
      sequence:
      - choose:
        - conditions:
          - condition: state
            entity_id: timer.ms3
            state: active
          sequence:
          - action: timer.cancel
            target:
              entity_id: timer.lw03
            data: {}
          - action: timer.start
            target:
              entity_id: timer.lw03
            data: {}
          - choose:
            - conditions:
              - condition: state
                entity_id: binary_sensor.tod_night
                state: 'on'
              sequence:
              - target:
                  entity_id: light.lampochka_3
                action: light.turn_on
                data:
                  brightness_pct: 10
                  rgb_color:
                  - 0
                  - 255
                  - 255
                enabled: false
            - conditions:
              - condition: state
                entity_id: binary_sensor.tod_foll_night_os
                state: 'on'
              - condition: state
                entity_id: timer.sw4k4
                state: idle
              sequence:
              - target:
                  entity_id: light.lampochka_3
                action: light.turn_on
                data:
                  brightness_pct: 30
                  kelvin: 4200
        - conditions:
          - condition: state
            entity_id: timer.ms3
            state: idle
          sequence:
          - action: light.turn_off
            target:
              device_id: 2519fe869b93b107ae307fed766beb9f
            data: {}
  mode: single
- id: '1725850665772'
  alias: Theme
  description: Смена темы Home Assistant для дня и ночи
  trigger:
  - platform: homeassistant
    event: start
  - platform: state
    entity_id: sun.sun
    to: above_horizon
  - platform: state
    entity_id: sun.sun
    to: below_horizon
  condition: []
  action:
  - action: frontend.set_theme
    data:
      mode: dark
      name: "{% if states.sun.sun.state == \"above_horizon\" %}\n  solarized_light\n{%
        else %}\n  night\n{% endif %}\n"
  mode: single
- id: '1725899439701'
  alias: Ds01 - tim
  description: запуск таймера при открытии двери
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.ds01_contact
    from: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
    to: 'on'
  condition: []
  action:
  - if:
    - condition: state
      entity_id: timer.ds01
      state: idle
    - condition: state
      entity_id: timer.ms4
      for:
        hours: 0
        minutes: 0
        seconds: 0
      state: active
    - condition: state
      entity_id: binary_sensor.tod_early_night
      state: 'on'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.sw4k2_on_off
  - data: {}
    target:
      entity_id: timer.ds01
    action: timer.cancel
  - data: {}
    target:
      entity_id: timer.ds01
    action: timer.start
  - metadata: {}
    data: {}
    target:
      entity_id: counter.ds01
    action: counter.increment
  - if:
    - condition: state
      entity_id: timer.ms4
      state: active
    then:
    - metadata: {}
      data: {}
      target:
        entity_id: input_boolean.userplace
      action: input_boolean.turn_off
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.pris_tim
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.ms4_xs7_on_off
  - choose:
    - conditions: []
      sequence: []
  mode: single
- id: '1725906105791'
  alias: Pris - tim
  description: ''
  trigger: []
  condition: []
  action:
  - action: timer.cancel
    target:
      entity_id: timer.pris
    data: {}
  - action: timer.start
    target:
      entity_id: timer.pris
    data: {}
  mode: single
- id: '1725906503582'
  alias: ds01 tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - timer.ds01
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition:
  - condition: state
    entity_id: binary_sensor.ds01_contact
    state: 'on'
  action:
  - action: timer.cancel
    target:
      entity_id: timer.ds01
    data: {}
  - action: timer.start
    target:
      entity_id: timer.ds01
    data: {}
  mode: single
- id: '1725906873444'
  alias: Pris - Tg msg
  description: мало движения в пространстве
  triggers:
  - entity_id:
    - timer.pris
    for:
      hours: 0
      minutes: 0
      seconds: 1
    to: idle
    from: active
    trigger: state
  - event: sunrise
    offset: -00:30:00
    enabled: false
    trigger: sun
  conditions: []
  actions:
  - action: timer.cancel
    target:
      entity_id: timer.pris
    data: {}
  - action: timer.start
    target:
      entity_id: timer.pris
    data: {}
  - if:
    - condition: sun
      after: sunrise
      after_offset: 00:00:01
      enabled: true
      before: sunset
      before_offset: 02:00:00
    then:
    - data:
        title: ⛑ Датчики
        message: "неактивны  \n{{ relative_time(state_attr('automation.pris_tim',
          'last_triggered')) | replace(\"hours\", \"час.\", 1) | replace(\"hour\",
          \"час.\", 1) |  replace(\"minutes\", \"мин.\", 1) }} ⌚️ {{ states('sensor.time')
          }} \n"
      action: notify.gHA
  mode: single
- id: '1725968402669'
  alias: Ds02 - tim
  description: запуск таймера при открытии ворот
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.ds02_contact
    from: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
    to: 'on'
  condition: []
  action:
  - action: automation.trigger
    target:
      entity_id: automation.ds02_tim_2
    data:
      skip_condition: true
  - action: automation.trigger
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.xs5_on_off
  - action: counter.increment
    target:
      entity_id: counter.ds02
    data: {}
  mode: single
- id: '1725968744725'
  alias: ds02 tim
  description: ''
  triggers:
  - entity_id:
    - timer.ds02
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.ds02_contact
    state: 'on'
  actions:
  - action: timer.cancel
    target:
      entity_id: timer.ds02
    data: {}
  - action: timer.start
    target:
      entity_id: timer.ds02
    data: {}
  - action: timer.change
    metadata: {}
    data:
      duration: '-6'
    target:
      entity_id: timer.ds02
  mode: single
- id: '1725970937211'
  alias: Ds02 - Tg msg
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.ds02_contact
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  - entity_id:
    - binary_sensor.ds02_contact
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  conditions: []
  actions:
  - action: timer.cancel
    target:
      entity_id: timer.ds02_lx
    data: {}
  - action: timer.start
    target:
      entity_id: timer.ds02_lx
    data: {}
  - if:
    - condition: state
      entity_id: binary_sensor.ds02_contact
      state: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    then:
    - action: notify.gHA
      data:
        title: "\U0001F9F0 Ворота"
        message: "открываются\n⌚️ {{ states('sensor.time') }} \n"
        data:
          disable_notification: false
  - if:
    - condition: state
      entity_id: binary_sensor.ds02_contact
      state: 'off'
      for:
        hours: 0
        minutes: 0
        seconds: 0
    then:
    - action: notify.gHA
      data:
        title: "\U0001F9E4 Ворота"
        message: "закрыты\n⌚️ {{ states('sensor.time') }} \n"
        data:
          disable_notification: true
  mode: single
- id: '1726022098684'
  alias: B1r - Tim
  description: ''
  trigger:
  - platform: state
    entity_id:
    - switch.b1r
    to: 'on'
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: switch.b1r
  mode: single
- id: '1726108773621'
  alias: Xs5 - tim
  description: Включим свет
  trigger:
  - platform: state
    entity_id:
    - switch.xs5
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: 'on'
  condition: []
  action:
  - action: timer.cancel
    target:
      entity_id:
      - timer.xs5
    data: {}
  - action: timer.start
    target:
      entity_id:
      - timer.xs5
    data: {}
  mode: single
- id: '1726499498860'
  alias: Xs3 - tim
  description: Включим свет
  trigger:
  - platform: state
    entity_id:
    - switch.xs3
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: 'on'
  condition: []
  action:
  - action: timer.cancel
    target:
      entity_id:
      - timer.xs3
    data: {}
  - action: timer.start
    target:
      entity_id:
      - timer.xs3
    data: {}
  mode: single
- id: '1726499704476'
  alias: Xs3 On/Off
  description: Включим свет
  trigger: []
  condition: []
  action:
  - if:
    - condition: state
      entity_id: switch.xs3
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: timer.ms3
        state: idle
    then:
    - action: timer.cancel
      target:
        entity_id:
        - timer.xs3
      data: {}
    - action: timer.start
      target:
        entity_id:
        - timer.xs3
      data: {}
  - if:
    - condition: state
      entity_id: switch.xs3
      state: 'on'
    - condition: state
      entity_id: timer.xs3
      state: idle
    then:
    - action: switch.turn_off
      metadata: {}
      data: {}
      target:
        entity_id: switch.xs3
  mode: single
- id: '1727086930213'
  alias: Tr2 21/25 - Tg msg
  description: ''
  triggers:
  - entity_id:
    - sensor.tr2_temperature
    for:
      hours: 0
      minutes: 0
      seconds: 5
    above: 25
    trigger: numeric_state
  - entity_id:
    - sensor.tr2_temperature
    for:
      hours: 0
      minutes: 0
      seconds: 5
    below: 21
    trigger: numeric_state
  conditions:
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.tr2_temperature
      above: 25
    - condition: numeric_state
      entity_id: sensor.tr2_temperature
      below: 21
  actions:
  - data:
      title: ⁉️ Датчик зал за пределами
      message: "\U0001F4DF Котёл {{ states('sensor.kotel_kotel') }}\n\U0001F321 зал
        {{ states('sensor.tr2_temperature') }}\n\U0001F321 кор {{ states('sensor.tr01_temperature')
        }}\n\U0001F321 сени {{ states('sensor.klimat_seni1_t1') }}\n\U0001F321 ул
        {{ states('sensor.kotel_ulitsa_k') }}\n\U0001F321 ГВС {{ states('sensor.kotel_goriachei_vody')
        }}\n\U0001F321 СО {{ states('sensor.kotel_otopleniia') }}\n\U0001F6B0 Горячая
        вода {{ states('sensor.kotel_goriachaia_voda') }}\n♻️ Отопление {{ states('sensor.kotel_otoplenie')
        }}\n\U0001F39B Отопление {{ states('switch.kotel_otoplenie') }}\n\U0001F39B
        Горячая вода {{ states('switch.kotel_gvs') }}\n"
    action: notify.gHA
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.tr2_21_25_tg_msg
  mode: single
- id: '1727231101949'
  alias: Tr2 Err - Tg msg
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.tr2_temperature
    to: unavailable
    for:
      hours: 0
      minutes: 3
      seconds: 5
  - platform: state
    entity_id:
    - sensor.tr2_temperature
    to: unknown
    for:
      hours: 0
      minutes: 3
      seconds: 5
  condition: []
  action:
  - data:
      title: Датчик температуры
      message: 'состояние - {{ states(''sensor.tr2_temperature'') }} '
    action: notify.gHA
  mode: single
- id: '1727717389334'
  alias: b1kr1 S
  description: ''
  triggers:
  - entity_id:
    - sensor.b1kr1_action
    trigger: state
    attribute: action
    to: single
  conditions: []
  actions:
  - action: light.toggle
    metadata: {}
    data: {}
    target:
      device_id:
      - 7200186a7aabfb3a8a39005a3897fc4e
  mode: single
- id: '1727879621879'
  alias: HA_ReBoot
  description: ''
  trigger: []
  condition: []
  action:
  - action: hassio.host_reboot
    metadata: {}
    data: {}
  mode: single
- id: '1728239189433'
  alias: Ts PreSet
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.tod_night_boiler
  conditions: []
  actions:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: true
    target:
      entity_id:
      - automation.ts_preset_eco
  - if:
    - condition: state
      entity_id: binary_sensor.tod_night_boiler
      state: 'on'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.ts_preset_comfort
  - if:
    - condition: state
      entity_id: binary_sensor.tod_night_boiler
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.ts_preset_away
  mode: single
- id: '1728392326854'
  alias: b1kr1 D
  description: ''
  triggers:
  - entity_id:
    - sensor.b1kr1_action
    trigger: state
    attribute: action
    to: double
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: light.lampochka_1
        above: 3100
        below: 3300
        attribute: color_temp_kelvin
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          kelvin: 6500
        target:
          device_id: 7200186a7aabfb3a8a39005a3897fc4e
    - conditions:
      - condition: numeric_state
        entity_id: light.lampochka_1
        attribute: color_temp_kelvin
        below: 3100
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          kelvin: 3200
        target:
          device_id: 7200186a7aabfb3a8a39005a3897fc4e
    - conditions:
      - condition: numeric_state
        entity_id: light.lampochka_1
        attribute: color_temp_kelvin
        above: 3300
      sequence:
      - action: light.turn_on
        metadata: {}
        data:
          kelvin: 2000
        target:
          device_id: 7200186a7aabfb3a8a39005a3897fc4e
  mode: single
- id: '1728392359360'
  alias: b1kr1 L
  description: ''
  triggers:
  - entity_id:
    - sensor.b1kr1_action
    trigger: state
    attribute: action
    to: rotate_left
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: light.lampochka_1
        above: 63
        attribute: brightness
      sequence:
      - action: light.turn_on
        target:
          entity_id:
          - light.lampochka_1
        data:
          brightness_step_pct: -25
          kelvin: 3202
    - conditions:
      - condition: numeric_state
        entity_id: light.lampochka_1
        attribute: brightness
        below: 64
      sequence:
      - action: light.turn_on
        target:
          entity_id:
          - light.lampochka_1
        data:
          brightness_pct: 1
          kelvin: 2000
  mode: single
- id: '1728392380117'
  alias: b1kr1 R
  description: ''
  triggers:
  - entity_id:
    - sensor.b1kr1_action
    trigger: state
    attribute: action
    to: rotate_right
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: light.lampochka_1
        above: 190
        attribute: brightness
      sequence:
      - action: light.turn_on
        target:
          entity_id:
          - light.lampochka_1
        data:
          brightness_pct: 100
          kelvin: 6500
    - conditions:
      - condition: numeric_state
        entity_id: light.lampochka_1
        attribute: brightness
        below: 191
      sequence:
      - action: light.turn_on
        target:
          entity_id:
          - light.lampochka_1
        data:
          brightness_step_pct: 25
          kelvin: 3202
  mode: single
- id: '1728392500894'
  alias: b1kr1 H
  description: ''
  triggers:
  - entity_id:
    - sensor.b1kr1_action
    trigger: state
    attribute: action
    to: hold
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: sensor.b1k_action
      state: double
    then:
    - action: light.toggle
      metadata: {}
      data: {}
      target:
        device_id:
        - 7200186a7aabfb3a8a39005a3897fc4e
  mode: single
- id: '1729161733298'
  alias: Vs1 Sens
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.vs1_water_leak
    to: 'on'
  conditions: []
  actions:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.protechka_tg_msg
  - action: light.turn_on
    metadata: {}
    data:
      kelvin: 6500
      brightness_pct: 100
    target:
      entity_id: light.lampochka_3
  mode: single
- id: '1729162480061'
  alias: Boiler Otoplenie Sens On/Off
  description: ''
  triggers:
  - entity_id:
    - sensor.kotel_otoplenie
    from: ➖
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: ✅
    trigger: state
  - entity_id:
    - sensor.kotel_otoplenie
    from: ✅
    for:
      hours: 0
      minutes: 0
      seconds: 3
    to: ➖
    trigger: state
  actions:
  - action: input_datetime.set_datetime
    metadata: {}
    data:
      time: ' {{ as_timestamp(states.input_boolean.ts20.last_changed) | timestamp_custom(''%H:%M:%S'')
        }} '
    target:
      entity_id: input_datetime.tsa_time
  - if:
    - condition: state
      entity_id: sensor.kotel_otoplenie
      state: ✅
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.kotel_otoplenie_telegram
    - if:
      - condition: state
        entity_id: switch.kotel_otoplenie
        state: 'off'
      then:
      - data:
          title: ⁉️ Контроллер
          message: 'Нет согласования, Отопление

            Статус {{ states(''sensor.kotel_otoplenie'') }}

            Задано {{ states(''switch.kotel_otoplenie'') }}

            '
          data:
            disable_notification: false
        action: notify.gHA
  - if:
    - condition: state
      entity_id: sensor.kotel_otoplenie
      state: ➖
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.kotel_otoplenie_telegram
    - if:
      - condition: state
        entity_id: switch.kotel_otoplenie
        state: 'on'
      then:
      - data:
          title: ⁉️ Контроллер
          message: 'Нет согласования, Отопление

            Статус {{ states(''sensor.kotel_otoplenie'') }}

            Задано {{ states(''switch.kotel_otoplenie'') }}

            '
          data:
            disable_notification: false
        action: notify.gHA
  - if:
    - condition: state
      state: ➖
      entity_id: sensor.kotel_otoplenie
      enabled: true
    - condition: or
      conditions:
      - condition: state
        entity_id: light.lampochka_3
        state: 'off'
      - condition: and
        conditions:
        - condition: state
          entity_id: light.lampochka_3
          state: 'on'
        - condition: state
          entity_id: light.lampochka_3
          attribute: color_mode
          state: hs
        - condition: numeric_state
          entity_id: light.lampochka_3
          attribute: brightness
          below: 17
          enabled: true
    then:
    - if:
      - condition: state
        entity_id: sensor.kotel_gorelka
        state: ➖
      then:
      - action: light.turn_on
        metadata: {}
        data:
          brightness_pct: 5
          transition: 3
          rgb_color:
          - 0
          - 0
          - 255
        target:
          entity_id: light.lampochka_3
      - delay:
          hours: 0
          minutes: 0
          seconds: 4
          milliseconds: 0
      - action: timer.start
        target:
          entity_id:
          - timer.lw03
        data: {}
- id: '1729163076652'
  alias: Protechka - Tg msg
  description: ''
  triggers: []
  actions:
  - action: notify.me
    data:
      title: Протечка {{ states('binary_sensor.vs1_water_leak') }}
      message: "\U0001F321 зал {{ states('sensor.tr2_temperature') }}\n\U0001F321
        кор {{ states('sensor.tr01_temperature') }}\n\U0001F321 сени {{ states('sensor.klimat_seni1_t1')
        }}\n\U0001F321 ул {{ states('sensor.kotel_ulitsa_k') }}\n\U0001F321 СО {{
        states('sensor.kotel_otopleniia') }}\n⌚️ {{ states('sensor.time') }}    \n"
      data:
        disable_notification: false
    enabled: true
  - data:
      title: Протечка {{ states('binary_sensor.vs1_water_leak') }}
      message: "\U0001F321 зал {{ states('sensor.tr2_temperature') }}\n\U0001F321
        кор {{ states('sensor.tr01_temperature') }}\n\U0001F321 сени {{ states('sensor.klimat_seni1_t1')
        }}\n\U0001F321 ул {{ states('sensor.kotel_ulitsa_k') }}\n\U0001F321 СО {{
        states('sensor.kotel_otopleniia') }}\n⌚️ {{ states('sensor.time') }}   \n"
      data:
        disable_notification: true
    action: notify.gHA
    enabled: false
- id: '1729164239582'
  alias: Ys - msg
  description: ''
  triggers: []
  conditions: []
  actions:
  - action: yandex_station.send_command
    metadata: {}
    data:
      command: setVolume
      volume: 20
    target:
      entity_id: media_player.yandex_station_r109xd000fzvhy
    enabled: false
  - action: yandex_station.send_command
    metadata: {}
    data:
      text: Время
      command: sendText
    target:
      entity_id: media_player.yandex_station_r109xd000fzvhy
  - delay:
      hours: 0
      minutes: 0
      seconds: 2
      milliseconds: 0
  mode: single
- id: '1729788635650'
  alias: l3 off
  description: ''
  triggers: []
  conditions:
  - condition: state
    entity_id: light.lampochka_3
    state: 'on'
  actions:
  - action: light.turn_on
    metadata: {}
    data:
      brightness_step_pct: -1
    target:
      entity_id: light.lampochka_3
  - delay:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 300
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.l3_off
  mode: parallel
  max: 50
- id: '1729837406953'
  alias: TS20 Set Dn
  description: ''
  triggers:
  - trigger: template
    value_template: '{{ state_attr(''climate.termostat'', ''current_temperature'')
      > (states(''input_number.in_ts20s'') | float) - 0.0 }}'
    for:
      hours: 0
      minutes: 25
      seconds: 0
    enabled: true
  conditions: []
  actions:
  - action: input_number.set_value
    target:
      entity_id: input_number.in_ts20
    data:
      value: ' {{ (states(''input_number.in_ts20s'') | float) + 0.0  }} '
  mode: single
- id: '1729842985819'
  alias: TS20 Set Up
  description: ''
  triggers:
  - trigger: template
    value_template: '{{ state_attr(''climate.termostat'', ''current_temperature'')
      < (states(''input_number.in_ts20s'') | float) + 0.5 }}'
    for:
      hours: 0
      minutes: 25
      seconds: 0
    enabled: true
  conditions: []
  actions:
  - action: input_number.set_value
    target:
      entity_id: input_number.in_ts20
    data:
      value: ' {{ (states(''input_number.in_ts20s'') | float) + 0.5  }} '
  mode: single
- id: '1730191033831'
  alias: Ts PreSet Comfort
  description: ''
  triggers: []
  conditions: []
  actions:
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: comfort
    target:
      entity_id:
      - climate.termostate_1
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: comfort
    target:
      entity_id: climate.termostate_2
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: comfort
    target:
      entity_id:
      - climate.termostate_3
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: comfort
    target:
      entity_id:
      - climate.termostate_0
  mode: single
- id: '1730191115957'
  alias: Ts PreSet Away
  description: ''
  triggers: []
  conditions: []
  actions:
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: away
    target:
      entity_id:
      - climate.termostate_1
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: away
    target:
      entity_id: climate.termostate_2
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: away
    target:
      entity_id:
      - climate.termostate_3
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: away
    target:
      entity_id:
      - climate.termostate_0
  mode: single
- id: '1730264627892'
  alias: Ts PreSet Eco
  description: ''
  triggers: []
  conditions: []
  actions:
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: eco
    target:
      entity_id:
      - climate.termostate_1
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: eco
    target:
      entity_id: climate.termostate_2
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: eco
    target:
      entity_id:
      - climate.termostate_3
  - action: climate.set_preset_mode
    metadata: {}
    data:
      preset_mode: eco
    target:
      entity_id:
      - climate.termostate_0
  mode: single
- id: '1730378630243'
  alias: N-hour
  description: ''
  triggers:
  - trigger: time_pattern
    minutes: '59'
    seconds: '28'
    enabled: true
  - trigger: time_pattern
    minutes: '29'
    seconds: '28'
    enabled: true
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ state_attr(''climate.termostat'', ''temperature'') > (states(''input_number.in_ts20s'')
          | float) + 0.25 }}'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.in_ts20
        data:
          value: ' {{ (states(''input_number.in_ts20s'') | float) + 0.0  }} '
      - delay:
          hours: 0
          minutes: 0
          seconds: 20
          milliseconds: 0
        enabled: true
      - action: input_number.set_value
        target:
          entity_id: input_number.in_ts20
        data:
          value: ' {{ (states(''input_number.in_ts20s'') | float) + 0.5  }} '
    - conditions:
      - condition: template
        value_template: '{{ state_attr(''climate.termostat'', ''temperature'') < (states(''input_number.in_ts20s'')
          | float) + 0.25 }}'
      sequence:
      - action: input_number.set_value
        target:
          entity_id: input_number.in_ts20
        data:
          value: ' {{ (states(''input_number.in_ts20s'') | float) + 0.5  }} '
      - delay:
          hours: 0
          minutes: 0
          seconds: 20
          milliseconds: 0
        enabled: true
      - action: input_number.set_value
        target:
          entity_id: input_number.in_ts20
        data:
          value: ' {{ (states(''input_number.in_ts20s'') | float) + 0.0  }} '
    enabled: true
  mode: single
- id: '1730399343408'
  alias: TS20 Action
  description: ''
  triggers:
  - trigger: template
    value_template: '{{ state_attr(''climate.termostat'', ''current_temperature'')
      > ( state_attr(''climate.termostat'', ''temperature'') + (states(''input_number.in_ts20g'')
      | float) - 0.1 ) }}'
    id: '1'
  - trigger: template
    value_template: '{{ state_attr(''climate.termostat'', ''current_temperature'')
      < ( state_attr(''climate.termostat'', ''temperature'') - (states(''input_number.in_ts20g'')
      | float) + 0.1 ) }}'
    id: '2'
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - '1'
      - condition: state
        entity_id: input_boolean.ts20
        state: 'on'
      sequence:
      - action: input_datetime.set_datetime
        metadata: {}
        data:
          time: ' {{ (as_timestamp(now()) -18000 - as_timestamp(states.input_boolean.ts20.last_changed))
            | timestamp_custom(''%H:%M:%S'') }} '
        target:
          entity_id: input_datetime.ts20_time
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.ts20
    - conditions:
      - condition: trigger
        id:
        - '2'
      - condition: state
        entity_id: input_boolean.ts20
        state: 'off'
      sequence:
      - action: input_datetime.set_datetime
        metadata: {}
        data:
          time: ' {{ (as_timestamp(now()) -18000 - as_timestamp(states.input_boolean.ts20.last_changed))
            | timestamp_custom(''%H:%M:%S'') }} '
        target:
          entity_id: input_datetime.ts20_time
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id:
          - input_boolean.ts20
      - action: timer.pause
        metadata: {}
        data: {}
        target:
          entity_id:
          - timer.ts20f
  mode: single
- id: '1730528091922'
  alias: Ms3 - tim
  description: ''
  triggers:
  - type: occupied
    device_id: 4f7476725d9dceb90bdbd305516fc45b
    entity_id: 20d6ff06d73852819f8b8410a3278c1e
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: device
  conditions: []
  actions:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.ms3_tim
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.ms3_run
  mode: single
- id: '1730658534847'
  alias: Ts20 tim - Tg msg
  description: ''
  triggers:
  - trigger: template
    value_template: '{{ state_attr(''climate.termostat'', ''current_temperature'')
      < (states(''input_number.in_ts20s'') | float) - 1.5 }}'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    enabled: true
  - trigger: template
    value_template: '{{ state_attr(''climate.termostat'', ''current_temperature'')
      < 18.1 }}'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - entity_id:
    - climate.termostat
    for:
      hours: 0
      minutes: 8
      seconds: 0
    trigger: state
    to: unavailable
  - trigger: state
    entity_id:
    - timer.ts20
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 3
  conditions:
  - condition: or
    conditions:
    - condition: not
      conditions:
      - condition: state
        entity_id: climate.termostat
        state: heat_cool
    - condition: numeric_state
      entity_id: climate.termostat
      attribute: current_temperature
      below: 18.1
    - condition: template
      value_template: '"{{ state_attr(''climate.termostat'', ''current_temperature'')
        < (states(''input_number.in_ts20s'') | float) - 1.5 }}"'
  actions:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: true
    target:
      entity_id:
      - automation.ts20_tg_msg_g
  - action: timer.cancel
    data: {}
    enabled: true
    target:
      entity_id: timer.ts20
  - action: timer.start
    data: {}
    enabled: true
    target:
      entity_id: timer.ts20
  - action: notify.gEO
    data:
      message: ⚠️ {{ states('sensor.time') }}
      data:
        disable_notification: false
    enabled: true
  mode: single
- id: '1730659588587'
  alias: Ts20 - Tg msg
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.ts20
    to: 'on'
    from: 'off'
  - trigger: state
    entity_id:
    - input_boolean.ts20
    to: 'off'
    from: 'on'
  actions:
  - action: notify.gEO
    data:
      title: "{{ states.input_boolean.ts20.last_changed| as_timestamp | timestamp_custom('%H:%M')
        }} {% if is_state('input_boolean.ts20', 'on') %}✅ {% elif is_state('climate.termostat',
        'heat_cool') %}❄️ {% elif is_state('climate.termostat', 'off') %}\U0001F232
        {% elif not is_state('climate.termostat', 'off') %}Ошибка {% endif %}"
      message: "{{ state_attr('climate.termostat', 'current_temperature') }} Тек\U0001F321\n{{
        state_attr('climate.termostat', 'temperature') }} {{ ( state_attr('climate.termostat',
        'temperature') == (states('input_number.in_ts20s')|float) ) | iif('', '('+
        states('input_number.in_ts20s')+')' ) }} Уст\U0001F321\n{{ states('input_datetime.ts20_time')
        }} {% if is_state('input_boolean.ts20', 'on') %}\U0001F4C9{% elif is_state('input_boolean.ts20',
        'off') %}\U0001F4C8{% endif %}\n"
      data:
        disable_notification: true
    enabled: true
- id: '1730796156096'
  alias: tg stat_s
  description: ''
  triggers:
  - event_type: telegram_command
    event_data:
      command: /stat_s
    context: {}
    trigger: event
  - event_type: telegram_command
    event_data:
      command: /stat_s@asg_ha_bot
    context: {}
    trigger: event
  actions:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: true
    target:
      entity_id:
      - automation.ts20_tg_msg_s
- id: '1730948003421'
  alias: Ts20 - Tg msg U
  description: ''
  triggers: []
  actions:
  - action: notify.gEO
    data:
      title: "{{ states.input_boolean.ts20.last_changed| as_timestamp | timestamp_custom('%H:%M')
        }}({{(as_timestamp(now()) -18000 - as_timestamp(states.input_boolean.ts20.last_changed))
        | timestamp_custom('%H:%M')}}){% if is_state('input_boolean.ts20', 'on') %}✅
        {% elif is_state('climate.termostat', 'heat_cool') %}❄️ {% elif is_state('climate.termostat',
        'off') %}\U0001F232 {% elif not is_state('climate.termostat', 'off') %}Ошибка
        {% endif %}"
      message: "{{ states('input_number.in_ts20s') }} ПредУст\U0001F321\n{{ states('input_number.in_ts20g')
        }} Гист\U0001FAA1\n{{ state_attr('climate.termostat', 'current_temperature')
        }} Тек\U0001F321\n{{ state_attr('climate.termostat', 'temperature') }} Уст\U0001F321\n⌚️{{
        states('sensor.time') }}\n"
      data:
        disable_notification: false
    enabled: true
- id: '1731006782873'
  alias: TS20 Set
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_number.in_ts20
    for:
      hours: 0
      minutes: 0
      seconds: 1
  conditions: []
  actions:
  - action: climate.set_temperature
    target:
      entity_id: climate.termostat
    data:
      temperature: ' {{ states(''input_number.in_ts20'') }} '
  mode: single
- id: '1731093868668'
  alias: TS20 Set Ust
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - switch.termostat_child_lock
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 5
  conditions: []
  actions:
  - if:
    - condition: numeric_state
      entity_id: climate.termostat
      above: 16
      attribute: temperature
    then:
    - action: input_number.set_value
      target:
        entity_id: input_number.in_ts20s
      data:
        value: ' {{ state_attr(''climate.termostat'', ''temperature'') + 0.0 | float
          }} '
    - action: input_number.set_value
      target:
        entity_id: input_number.in_ts20
      data:
        value: ' {{ state_attr(''climate.termostat'', ''temperature'') + 0.0 | float
          }} '
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: true
    target:
      entity_id: automation.ts20_tg_msg_g
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: switch.termostat_child_lock
  mode: single
- id: '1731229486525'
  alias: Ts20 - Tg msg S
  description: ''
  triggers: []
  actions:
  - action: notify.gEO
    data:
      title: "{{ states.input_boolean.ts20.last_changed| as_timestamp | timestamp_custom('%H:%M')
        }}({{(as_timestamp(now()) -18000 - as_timestamp(states.input_boolean.ts20.last_changed))
        | timestamp_custom('%H:%M')}}){% if is_state('input_boolean.ts20', 'on') %}✅
        {% elif is_state('climate.termostat', 'heat_cool') %}❄️ {% elif is_state('climate.termostat',
        'off') %}\U0001F232 {% elif not is_state('climate.termostat', 'off') %}Ошибка
        {% endif %}"
      message: "{{ state_attr('climate.termostat', 'current_temperature') }} Тек\U0001F321\n{{
        state_attr('climate.termostat', 'temperature') }} Уст\U0001F321\n⌚️{{ states('sensor.time')
        }}\n"
      data:
        disable_notification: true
    enabled: true
- id: '1731308180135'
  alias: ms5 tim
  description: ''
  triggers:
  - entity_id:
    - timer.ms5
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 1
    trigger: state
  conditions:
  - condition: state
    entity_id: binary_sensor.ms5_occupancy
    state: 'on'
  actions:
  - action: timer.cancel
    target:
      entity_id: timer.ms5
    data: {}
  - action: timer.start
    target:
      entity_id: timer.ms5
    data: {}
  mode: single
- id: '1731308209278'
  alias: Ms5 - tim
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.ms5_occupancy
    to: 'on'
  conditions: []
  actions:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.ms5_tim
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id: automation.ms5_run
  mode: single
- id: '1731353149117'
  alias: Ms5 - Run
  description: ''
  triggers: []
  conditions: []
  actions:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.lw3_on_off
    enabled: false
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: false
    target:
      entity_id:
      - automation.pris_tim
  mode: single
- id: '1731396932481'
  alias: Ts20f tim
  description: ''
  triggers:
  - trigger: template
    value_template: '{{ state_attr(''climate.termostat'', ''current_temperature'')
      < (states(''input_number.in_ts20s'') | float) + (states(''input_number.in_ts20g'')
      | float) - 0.2 }}'
    for:
      hours: 0
      minutes: 30
      seconds: 0
  - trigger: state
    entity_id:
    - input_boolean.ts20
    to: 'off'
    for:
      hours: 1
      minutes: 0
      seconds: 0
  - trigger: state
    entity_id:
    - timer.ts20f
    to: idle
    for:
      hours: 0
      minutes: 0
      seconds: 3
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: input_boolean.ts20
      state: 'on'
  actions:
  - action: timer.cancel
    data: {}
    enabled: true
    target:
      entity_id:
      - timer.ts20f
  - action: timer.start
    data: {}
    enabled: true
    target:
      entity_id:
      - timer.ts20f
  - if:
    - condition: template
      value_template: '{{ state_attr(''climate.termostat'', ''current_temperature'')
        < (states(''input_number.in_ts20s'') | float) + 0.6 }}'
    then:
    - action: input_number.set_value
      target:
        entity_id: input_number.in_ts20
      data:
        value: ' {{ (states(''input_number.in_ts20s'') | float) + (states(''input_number.in_ts20g'')
          | float) + 0.5 }} '
    - delay:
        hours: 0
        minutes: 0
        seconds: 30
        milliseconds: 0
      enabled: true
    - action: input_number.set_value
      target:
        entity_id: input_number.in_ts20
      data:
        value: ' {{ (states(''input_number.in_ts20s'') | float) + 0.0  }} '
  mode: single
- id: '1731469484007'
  alias: Ts20 az
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.ts20
    from: 'on'
    to: 'off'
    for:
      hours: 3
      minutes: 0
      seconds: 0
  conditions: []
  actions:
  - action: input_number.set_value
    target:
      entity_id: input_number.in_ts20
    data:
      value: ' {{ state_attr(''climate.termostat'', ''current_temperature'') + states(''input_number.in_ts20g'')*3  }} '
  - delay:
      hours: 0
      minutes: 5
      seconds: 5
      milliseconds: 0
    enabled: true
  - action: input_number.set_value
    target:
      entity_id: input_number.in_ts20
    data:
      value: ' {{ (states(''input_number.in_ts20s'') | float) + 0.0  }} '
  mode: single
